---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# [amapGeocode](https://github.com/womeimingzi11/amapGeocode)
![](man/figures/hexSticker-logo.png){width=100px}
<!-- badges: start -->
<!-- badges: end -->

**amapGeocode** provides an interface for the AutoNavi(高德) Maps API geocoding services. API docs can be foun [here](https://lbs.amap.com/) and [here](https://lbs.amap.com/api/webservice/summary/). For now, amapGeocode can be used for both forward and revese geocoding powered by high-precision AutoNavi Maps API.

This project is still in a very early stage and only the geocodig function has been developed. So all the functions may change or supersede, so it's not recommanded to use this package in production environment till it goes to stable stage. When will the stable stage come? It depends my graduate progress.

amapGeocode is inspired by [baidumap](https://github.com/badbye/baidumap) and [baidugeo](https://github.com/ChrisMuir/baidugeo). If you want to choose the Baidu Map API, these packages are good choice.

Baidu or AutoNavi? Here is the main differences:

1. AutoNavi has significant high precise, in my case, the Results from Baidu were unsatisfactory.
2. Baidu with free verification provices really high request: 300,000/month for each geocode/reverse-geocode, while AutoNavi only provide 6,000/month.

## Installation
amapGeocode may be published to [CRAN](https://CRAN.R-project.org) once the first available version been finished.

For now, please install amapGeocode from GitHub following this command:
```{r install by remotes, eval=FALSE, message=TRUE, include=TRUE}
remotes::install_github('womeimingzi11/amapGeocode')
```

<!-- You can install the released version of amapGeocode from [CRAN](https://CRAN.R-project.org) with: -->

<!-- ``` r -->
<!-- install.packages("amapGeocode") -->
<!-- ``` -->

## Usage
### Geocoding
Before start geocoding and reverse geocoding, please (apply a AutoNavi Map API Key)[https://lbs.amap.com/dev/]. Set `amap_key` globally by following command:

```{r set amap_key, eval=FALSE, include=FALSE}
options(amap_key = 'REPLACE THIS BY YOUR KEY')
```

Then get result of geocoding, by `getCoord` function. 

```{r getCoord_to_table_as_TRUE}
library(amapGeocode)
res <-
  getCoord('成都中医药大学')
knitr::kable(res)
```

The response we get from **AutoNavi Map API** is **JSON** or **XML**. For readability, we transform them to `tibble`, [a modern reimagining of the data.frame](https://tibble.tidyverse.org/), by setting `to_table` argument as `FALSE` defaultly. At this situation, `getCoord` will automatically set `output` argument as `XML`, even this argument has setted as `JSON`.

If anyone want to get response as **JSON** or **XML**, please set `to_table = TRUE`. If anyone want to extract information from **JSON** or **XML**. The result can further be parsed by `extractCoord`.

```{r getCoord_to_table_as_FALSE}
res <-
  getCoord('成都中医药大学', to_table = FALSE)
res
```

`extractCoord` is created to get result as tibble.

```{r extractCood}
res
tb <- 
  extractCoord(res)
knitr::kable(tb)
```
### Reverse Geocoding

get result of reverse geocoding, by `get` function. 

```{r getLocation_to_table_as_TRUE}
res <- 
  getLocation(104.043284, 30.666864)
knitr::kable(res)
```

The response we get from **AutoNavi Map API** is **JSON** or **XML**. For readability, we transform them to `tibble`, [a modern reimagining of the data.frame](https://tibble.tidyverse.org/), by setting `to_table` argument as `FALSE` defaultly. At this situation, `getLocation` will automatically set `output` argument as `XML`, even this argument has setted as `JSON`.

If anyone want to get response as **JSON** or **XML**, please set `to_table = TRUE`. If anyone want to extract information from **JSON** or **XML**. The result can further be parsed by `extractLocation`.

```{r getLocation_to_table_as_FALSE}
res <-
   getLocation(104.043284, 30.666864, to_table = FALSE)
res
```

`extractLocation` is created to get result as tibble.

```{r extractLocation}
res
tb <- 
  extractLocation(res)
knitr::kable(tb)
```

For more functions and improvements, Coming Soon!

## Bug report
It's very common for API upgrades to make the downstream application, like amapGeocode, to be unavilable. Feel free to [let me know](mailto://chenhan28@gmail.com) once it's broken or just open an issue.

## Acknowledgements
Hex Sticker was created by [hexSticker package](https://github.com/GuangchuangYu/hexSticker) with the world data from  [rnaturalearth](https://cran.r-project.org/web/packages/rnaturalearth/README.html).
